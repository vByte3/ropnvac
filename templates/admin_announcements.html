{% extends 'base.html' %}
{% block title %}Annonces & communications{% endblock %}
{% block content %}
<h2 style="color:#1a1a2e; text-align:center; margin-bottom:1.2rem;">ðŸ“£ Annonces & communications</h2>

<div style="background:white; padding:1.25rem; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08); margin-bottom:1.25rem;">
  <form method="post" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:0.75rem;">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <div style="grid-column:1 / -1;">
      <label style="display:block; font-weight:700; margin-bottom:0.35rem; color:#111827;">Titre</label>
      <input name="title" required style="width:100%; padding:0.65rem 0.8rem; border:1px solid #e0e0e0; border-radius:8px;" placeholder="Annonce, alerte, consigne">
    </div>
    <div>
      <label style="display:block; font-weight:700; margin-bottom:0.35rem; color:#111827;">Audience</label>
      <select name="audience" style="width:100%; padding:0.65rem 0.8rem; border:1px solid #e0e0e0; border-radius:8px;">
        <option value="all">Tous les rÃ©servistes</option>
        <option value="user">Cibler un RIO</option>
      </select>
    </div>
    <div>
      <label style="display:block; font-weight:700; margin-bottom:0.35rem; color:#111827;">RIO cible (optionnel)</label>
      <input name="target_rio" style="width:100%; padding:0.65rem 0.8rem; border:1px solid #e0e0e0; border-radius:8px;" placeholder="Ex: 123456">
      <small style="color:#6b7280;">UtilisÃ© si Audience = Cibler un RIO</small>
    </div>
    <div style="grid-column:1 / -1;">
      <label style="display:block; font-weight:700; margin-bottom:0.35rem; color:#111827;">Message</label>
      <textarea name="body" rows="4" required style="width:100%; padding:0.75rem; border:1px solid #e0e0e0; border-radius:8px; resize:vertical;" placeholder="DÃ©tails de l'annonce"></textarea>
    </div>
    <div style="grid-column:1 / -1; display:flex; justify-content:flex-end; gap:0.5rem;">
      <button type="submit" style="background:linear-gradient(135deg,#f97316 0%,#ea580c 100%); color:white; padding:0.75rem 1.4rem; border:none; border-radius:10px; font-weight:700; box-shadow:0 4px 12px rgba(234,88,12,0.35); cursor:pointer;">Publier l'annonce</button>
      <a href="/admin" style="display:inline-block; padding:0.75rem 1.1rem; background:#f3f4f6; color:#111827; border:1px solid #e5e7eb; border-radius:10px; font-weight:700; text-decoration:none;">Retour tableau de bord</a>
    </div>
  </form>
</div>

<div style="background:white; padding:1.1rem; border-radius:12px; box-shadow:0 4px 16px rgba(0,0,0,0.08);">
  <h3 style="margin-top:0; color:#111827;">Historique des annonces</h3>
  {% if announcements %}
    <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap:0.75rem;">
      {% for ann in announcements %}
        <div style="border:1px solid #e5e7eb; border-radius:10px; padding:0.9rem 1rem; box-shadow:0 2px 8px rgba(0,0,0,0.04);">
          <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:0.5rem;">
            <div>
              <div style="font-weight:700; color:#111827;">{{ ann.title }}</div>
              <div style="color:#6b7280; font-size:0.9rem;">{{ ann.created_at.strftime('%d/%m/%Y %H:%M') }} Â· {{ ann.created_by }}</div>
            </div>
            <span style="background:#eef2ff; color:#4338ca; padding:0.3rem 0.6rem; border-radius:999px; font-weight:700; font-size:0.85rem;">{{ 'Tous' if ann.audience == 'all' else ('RIO ' ~ ann.target_rio) }}</span>
          </div>
          <p style="margin:0.5rem 0; color:#111827; white-space:pre-wrap;">{{ ann.body }}</p>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p style="color:#6b7280;">Aucune annonce pour le moment.</p>
  {% endif %}
</div>
{% endblock %}
